<!-- TEST123 -->
<!-- Renamed from index.html for clarity. -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Church Management System</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <!-- <link rel="stylesheet" href="{% static 'css/mainblog.css' %}"> -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-church"></i>
                </div>
                <div class="church-info">
                    <h1>The Nest Church</h1>
                </div>
            </div>

            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <p class="user-name">Admin User</p>
                    <p class="user-role">Administrator</p>
                </div>
            </div>

            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" data-page="dashboard" class="nav-link active">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a></li>
                    <li><a href="#" data-page="members" class="nav-link">
                        <i class="fas fa-users"></i> Members
                    </a></li>
                    <li><a href="#" data-page="events" class="nav-link">
                        <i class="fas fa-calendar"></i> Events
                    </a></li>
                    <li><a href="#" data-page="blog" class="nav-link">
                        <i class="fas fa-blog"></i> blog
                    </a></li>
                    <li><a href="#" data-page="donations" class="nav-link">
                        <i class="fas fa-dollar-sign"></i> Donations
                    </a></li>
                    <li><a href="#" data-page="reports" class="nav-link">
                        <i class="fas fa-file-text"></i> Reports
                    </a></li>
                    <li><a href="#" data-page="settings" class="nav-link">
                        <i class="fas fa-cog"></i> Settings
                    </a></li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <button class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-btn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="page-title">Dashboard</h1>
                </div>
                <div class="header-right">
                    <div id="header-actions"></div>
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge"></span>
                    </button>
                    <div class="user-dropdown">
                        <button class="dropdown-toggle">
                            Admin <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-menu">
                            <a href="#">Profile</a>
                            <a href="#">Settings</a>
                            <a href="#">Logout</a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content" id="page-content">
                <!-- Dynamic content will be loaded here -->
            </div>
        </main>
    </div>
    <script type="module" src="{% static 'js/app.js' %}"></script>

    <!-- Modals -->
    <!-- Add Member Modal -->
    <div id="add-member-modal" class="modal">
      <div class="modal-content add-member-modal-content">
        <span class="modal-close" onclick="window.closeModal('add-member-modal')">&times;</span>
        <h2>Add Member</h2>
        <form id="add-member-form">
          <div class="add-member-form-row">
            <div class="form-group">
              <label for="add-member-first-name">First Name</label>
              <input type="text" id="add-member-first-name" name="first_name" required />
            </div>
            <div class="form-group">
              <label for="add-member-last-name">Last Name</label>
              <input type="text" id="add-member-last-name" name="last_name" required />
            </div>
            <div class="form-group">
              <label for="add-member-email">Email</label>
              <input type="email" id="add-member-email" name="email" required />
            </div>
          </div>
          <div class="add-member-form-row">
            <div class="form-group">
              <label for="add-member-phone">Phone</label>
              <input type="text" id="add-member-phone" name="phone" />
            </div>
            <div class="form-group">
              <label for="add-member-dob">Date of Birth</label>
              <input type="date" id="add-member-dob" name="date_of_birth" />
            </div>
            <div class="form-group">
              <label for="add-member-gender">Gender</label>
              <select id="add-member-gender" name="gender">
                <option value="">Select gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>
          <div class="add-member-form-row address-row">
            <div class="form-group">
              <label for="add-member-address-street">Address</label>
              <input type="text" id="add-member-address-street" name="street" placeholder="Street" />
            </div>
            <div class="form-group">
              <label for="add-member-address-city">&nbsp;</label>
              <input type="text" id="add-member-address-city" name="city" placeholder="City" />
            </div>
            <div class="form-group">
              <label for="add-member-address-state">&nbsp;</label>
              <input type="text" id="add-member-address-state" name="state" placeholder="State" />
            </div>
          </div>
          <div class="add-member-form-row">
            <div class="form-group">
              <label for="add-member-status">Member Status</label>
              <select id="add-member-status" name="status">
                <option value="">Select status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="new">New</option>
              </select>
            </div>
            <div class="form-group">
              <label for="add-member-join-date">Join Date</label>
              <input type="date" id="add-member-join-date" name="join_date" />
            </div>
          </div>
          <div style="margin-bottom: 16px;">
            <label>Ministries</label>
            <div class="ministries-row">
              <label><input type="checkbox" name="ministries" value="Worship Team" /> Worship Team</label>
              <label><input type="checkbox" name="ministries" value="Children's Ministry" /> Children's Ministry</label>
              <label><input type="checkbox" name="ministries" value="Men's Ministry" /> Men's Ministry</label>
              <label><input type="checkbox" name="ministries" value="Women's Ministry" /> Women's Ministry</label>
              <label><input type="checkbox" name="ministries" value="Outreach" /> Outreach</label>
            </div>
          </div>
          <div style="margin-bottom: 24px;">
            <label for="add-member-notes">Notes</label>
            <textarea id="add-member-notes" name="notes" placeholder="Additional notes about the member..."></textarea>
          </div>
          <div class="add-member-form-footer">
            <button type="submit" class="btn btn-primary">Add Member</button>
            <button type="button" class="btn btn-secondary" onclick="window.closeModal('add-member-modal')">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- View Member Modal -->
    <div id="view-member-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Member Details</h2>
          <button class="modal-close" onclick="window.closeModal('view-member-modal')">&times;</button>
        </div>
        <div id="member-details">
          <div><b>Name:</b> <span id="view-member-name"></span></div>
          <div><b>Email:</b> <span id="view-member-email"></span></div>
          <div><b>Phone:</b> <span id="view-member-phone"></span></div>
          <div><b>Status:</b> <span id="view-member-status"></span></div>
          <div><b>Join Date:</b> <span id="view-member-join-date"></span></div>
          <div><b>Ministry:</b> <span id="view-member-ministry"></span></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="window.closeModal('view-member-modal')">Close</button>
        </div>
      </div>
    </div>

    <!-- Edit Member Modal -->
    <div id="edit-member-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Member</h2>
          <button class="modal-close" onclick="window.closeModal('edit-member-modal')">&times;</button>
        </div>
        <form id="edit-member-form">
          <input type="hidden" name="id" id="edit-member-id" />
          <div class="form-group">
            <label for="edit-member-first-name">First Name</label>
            <input type="text" id="edit-member-first-name" name="first_name" class="form-control" required />
          </div>
          <div class="form-group">
            <label for="edit-member-last-name">Last Name</label>
            <input type="text" id="edit-member-last-name" name="last_name" class="form-control" required />
          </div>
          <div class="form-group">
            <label for="edit-member-email">Email</label>
            <input type="email" id="edit-member-email" name="email" class="form-control" required />
          </div>
          <div class="form-group">
            <label for="edit-member-phone">Phone</label>
            <input type="text" id="edit-member-phone" name="phone" class="form-control" />
          </div>
          <div class="form-group">
            <label for="edit-member-status">Status</label>
            <select id="edit-member-status" name="status" class="form-control">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="new">New</option>
            </select>
          </div>
          <div class="form-group">
            <label for="edit-member-join-date">Join Date</label>
            <input type="date" id="edit-member-join-date" name="join_date" class="form-control" />
          </div>
          <div class="form-group">
            <label for="edit-member-ministry">Ministry</label>
            <input type="text" id="edit-member-ministry" name="ministry" class="form-control" />
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <button type="button" class="btn btn-secondary" onclick="window.closeModal('edit-member-modal')">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Blog Post Modal -->
    <div id="blog-post-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="console.log('Close Blog Post modal clicked'); window.closeModal('blog-post-modal')">&times;</span>
            <h2>Create Blog Post</h2>
            <form id="blog-post-form">
                <!-- Form fields for creating a blog post -->
                <button type="submit" class="btn btn-primary">Publish Post</button>
                <button type="button" class="btn btn-secondary" onclick="console.log('Cancel Blog Post modal clicked'); window.closeModal('blog-post-modal')">Cancel</button>
            </form>
        </div>
    </div>

    <!-- View Blog Modal -->
    <div id="view-blog-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="console.log('Close View Blog modal clicked'); window.closeModal('view-blog-modal')">&times;</span>
            <h2>Blog Post Details</h2>
            <div id="blog-details">
                <!-- Blog post details will be populated here -->
            </div>
            <button type="button" class="btn btn-secondary" onclick="console.log('Close View Blog modal clicked'); window.closeModal('view-blog-modal')">Close</button>
        </div>
    </div>

    <!-- Delete Member Confirmation Modal -->
    <div id="delete-member-modal" class="modal">
      <div class="modal-content" style="max-width: 400px; text-align: center;">
        <div class="modal-header">
          <h2>Confirm Delete</h2>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this member?</p>
        </div>
        <div class="modal-footer" style="display: flex; justify-content: center; gap: 16px;">
          <button id="confirm-delete-member-btn" class="btn btn-danger">Delete</button>
          <button type="button" class="btn btn-secondary" onclick="window.closeModal('delete-member-modal')">Cancel</button>
        </div>
      </div>
    </div>

    <script>
    // Always use this fillMemberModal for the view-member-modal
    window.fillMemberModal = function(modalId, member) {
        console.log('fillMemberModal called with:', modalId, member);
        if (!member) return;
        if (modalId === 'view-member-modal') {
            document.getElementById('view-member-name').textContent = (member.first_name || member.firstName || '') + ' ' + (member.last_name || member.lastName || '');
            document.getElementById('view-member-email').textContent = member.email || '';
            document.getElementById('view-member-phone').textContent = member.phone || '';
            document.getElementById('view-member-status').textContent = member.status || '';
            document.getElementById('view-member-join-date').textContent = member.join_date || member.joinDate || '';
            document.getElementById('view-member-ministry').textContent = Array.isArray(member.ministry) ? member.ministry.join(', ') : (member.ministry || '');
        }
        // If you want to support edit-member-modal, add similar logic here
    };

    // Fill edit-member-modal with member data
    window.fillMemberModal = window.fillMemberModal || function(){};
    window.fillEditMemberModal = function(member) {
      console.log('fillEditMemberModal called with:', member);
      document.getElementById('edit-member-id').value = member.id || '';
      document.getElementById('edit-member-first-name').value = member.first_name || member.firstName || '';
      document.getElementById('edit-member-last-name').value = member.last_name || member.lastName || '';
      document.getElementById('edit-member-email').value = member.email || '';
      document.getElementById('edit-member-phone').value = member.phone || '';
      document.getElementById('edit-member-status').value = member.status || '';
      document.getElementById('edit-member-join-date').value = (member.join_date || member.joinDate || '').slice(0,10);
      document.getElementById('edit-member-ministry').value = Array.isArray(member.ministry) ? member.ministry.join(', ') : (member.ministry || '');
    };

    // Prevent background scroll when modal is open
    function toggleBodyScroll(show) {
      document.body.style.overflow = show ? 'hidden' : '';
    }

    // Enhance openModal/closeModal for scroll lock
    window._originalOpenModal = window.openModal;
    window._originalCloseModal = window.closeModal;
    window.openModal = function(id) {
      if (window._originalOpenModal) window._originalOpenModal(id);
      toggleBodyScroll(true);
    }
    window.closeModal = function(id) {
      if (window._originalCloseModal) window._originalCloseModal(id);
      toggleBodyScroll(false);
    }

    // Add Member form handler
    const addMemberForm = document.getElementById('add-member-form');
    if (addMemberForm) {
      addMemberForm.addEventListener('submit', function(e) {
        e.preventDefault();
        alert('Member added! (Demo only)');
        window.closeModal('add-member-modal');
        // TODO: Add real member logic here
      });
    }

    // Removed duplicate Edit Member form handler. Handled by main JS modules.

    // Blog Post form handler
    const blogPostForm = document.getElementById('blog-post-form');
    if (blogPostForm) {
      blogPostForm.addEventListener('submit', function(e) {
        e.preventDefault();
        alert('Blog post published! (Demo only)');
        window.closeModal('blog-post-modal');
        // TODO: Add real blog logic here
      });
    }

    // Utility to fetch member by ID (simulate API or use global data)
    function getMemberById(id) {
      if (window.app && window.app.data && window.app.data.members && window.app.data.members.members) {
        return window.app.data.members.members.find(m => m.id == id);
      }
      return null;
    }

    // Utility to fetch blog post by ID
    function getBlogById(id) {
      if (window.app && window.app.data && window.app.data.blog && window.app.data.blog.blog) {
        return window.app.data.blog.blog.find(b => b.id == id);
      }
      return null;
    }

    // Show member details in modal
    window.showMemberDetails = function(memberId) {
      const member = getMemberById(memberId);
      const detailsDiv = document.getElementById('member-details');
      if (member && detailsDiv) {
        detailsDiv.innerHTML = `
          <b>Name:</b> ${member.first_name || ''} ${member.last_name || ''}<br>
          <b>Email:</b> ${member.email || ''}<br>
          <b>Phone:</b> ${member.phone || ''}<br>
          <b>Status:</b> ${member.status || ''}<br>
          <b>Joined:</b> ${member.join_date || ''}
        `;
      } else if (detailsDiv) {
        detailsDiv.innerHTML = '<i>No member data found.</i>';
      }
      window.openModal('view-member-modal');
    }

    // Show blog post details in modal
    window.showBlogDetails = function(blogId) {
      const blog = getBlogById(blogId);
      const detailsDiv = document.getElementById('blog-details');
      if (blog && detailsDiv) {
        detailsDiv.innerHTML = `
          <b>Title:</b> ${blog.title || ''}<br>
          <b>Author:</b> ${blog.author || ''}<br>
          <b>Date:</b> ${blog.date || ''}<br>
          <b>Category:</b> ${blog.category || ''}<br>
          <b>Content:</b> ${blog.content || ''}
        `;
      } else if (detailsDiv) {
        detailsDiv.innerHTML = '<i>No blog post data found.</i>';
      }
      window.openModal('view-blog-modal');
    }

    // Example: Attach click handlers to member/blog lists (if rendered server-side)
    document.addEventListener('DOMContentLoaded', function() {
      // For member list
      document.querySelectorAll('[data-member-id]').forEach(function(el) {
        el.addEventListener('click', function() {
          window.showMemberDetails(this.getAttribute('data-member-id'));
        });
      });
      // For blog list
      document.querySelectorAll('[data-blog-id]').forEach(function(el) {
        el.addEventListener('click', function() {
          window.showBlogDetails(this.getAttribute('data-blog-id'));
        });
      });
    });
    </script>
</body>
</html>
